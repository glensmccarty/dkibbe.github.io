<h1 id="fail2ban-logwatch">Fail2ban &amp; Logwatch</h1>

<p>Fail2ban and Logwatch are easy to configure utilities that increase security on services.</p>

<p>Fail2ban will block the IP address of failed login attempt and Logwatch will email you with a log summary.</p>

<h2 id="assignment-objectives">Assignment Objectives</h2>

<p><em>After successfully completing this assignment you will be able to:</em></p>

<ul>
<li>Install and configure fail2ban.</li>
<li>Install and configure logwatch.</li>
</ul>

<h2 id="terms-you-should-know">Terms You Should Know</h2>



<h2 id="preparation">Preparation</h2>

<p>Set networking for the CentOS 7 virtual machine to bridged. <br>
Take a snapshot of the virtual machine before starting. <br>
Test IP address.</p>

<p>snapshot <br>
test ip a s <br>
install mutt</p>

<h3 id="install-epel">Install EPEL</h3>

<pre><code># yum install epel-release
</code></pre>

<h2 id="install-fail2ban">Install Fail2ban</h2>

<pre><code># yum install fail2ban
</code></pre>

<p>After installation <code>rpm -qi fail2ban</code> will give you a description of the program.</p>

<h2 id="firewalld">Firewalld</h2>

<p>Install and enable firewalld if needed.</p>

<h2 id="configuration">Configuration</h2>



<h3 id="filters-and-actions">Filters and Actions</h3>

<p>Copy <em>jail.conf</em> to <em>jail.local</em> or <em>/etc/fail2ban/jail.d/customisation.local</em></p>

<h3 id="ip-addresses-to-ignore">IP Addresses to Ignore</h3>

<pre><code>[DEFAULT]
# "ignoreip" can be an IP address, a CIDR mask or a DNS host
ignoreip = 127.0.0.1
bantime  = 3600
maxretry = 3
</code></pre>



<h3 id="email">Email</h3>

<p>If you wish to be notified of bans by email, modify this line with your email address:</p>

<pre><code>destemail = your_email@domain.com
</code></pre>

<p>Then find the line:</p>

<pre><code>action = %(action_)s 
</code></pre>

<p>and change it to</p>

<pre><code>action = %(action_mw)s
</code></pre>



<h3 id="jails">Jails</h3>

<p>Jails are the rules which fail2ban apply to a given application/log:</p>

<pre><code>[ssh]

enabled = true
port    = ssh
filter  = sshd
logpath  = /var/log/auth.log
maxretry = 3
</code></pre>

<h3 id="logging">Logging</h3>

<pre><code>Fail2ban writes to /var/log/fail2ban
</code></pre>

<h2 id="start-and-enable-fail2ban">Start and Enable fail2ban</h2>

<pre><code># systemctl start fail2ban
# systemctl enable fail2ban
</code></pre>

<h2 id="fail2ban-client">fail2ban-client</h2>

<pre><code># fail2ban-client status sshd
</code></pre>



<h2 id="logwatch">Logwatch</h2>

<pre><code># logwatch --service sshd --range=Today
</code></pre>

<h2 id="resources">Resources</h2>

<ul>
<li><a href="http://lintut.com/install-fail2ban-on-centos-7/">fail2ban</a></li>
<li><a href="https://www.youtube.com/watch?v=xcXheAWy7cU#t=190">Fail2ban at pycon 2014</a></li>
<li>man 5 jail.conf</li>
<li><a href="http://www.linux-mag.com/id/7800/">Linux Magazine: Logwatch</a></li>
</ul>

<blockquote>
  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>