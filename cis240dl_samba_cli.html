<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Samba on CentOS Using CLI Tools</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="Samba on CentOS Using CLI Tools"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2016-09-15 Thu"/>
<meta name="author" content="Dennis Kibbe"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/Core/Oldstyle.css" /> 
<style type="text/css"> pre {font-size: 80%; font-weight:bold; line-height: 120%; padding-top: 0.2em; padding-bottom: 0.2em; padding-left: 1em; padding-right: 1em; border-style: solid; border-left-width: 1em; border-top-width: thin; border-right-width: thin; border-bottom-width: thin; border-color: #95ABD0; color: #00428c; background-color: #e4e5e7;} </style>
<style type="text/css"> code {color: blue; font-weight:bold;} </style>
<script type="text/javascript" src="http://orgmode.org/org-info.js">
/**
 *
 * @source: http://orgmode.org/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://orgmode.org/org-info.js.
 *
 * Copyright (C) 2012-2013  Sebastian Rose
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://orgmode.org/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "http://dkibbe.github.io");
org_html_manager.set("LINK_UP", "http://dkibbe.github.io");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "0");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Samba on CentOS Using CLI Tools</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Introduction</a></li>
<li><a href="#sec-2">2 Assignment Objectives</a></li>
<li><a href="#sec-3">3 Terms You Should Know</a></li>
<li><a href="#sec-4">4 Preparation</a></li>
<li><a href="#sec-5">5 Install Samba</a></li>
<li><a href="#sec-6">6 Create Samba User</a></li>
<li><a href="#sec-7">7 Create a Samba Share</a>
<ul>
<li><a href="#sec-7-1">7.1 Add Content</a></li>
<li><a href="#sec-7-2">7.2 Add a Group</a></li>
<li><a href="#sec-7-3">7.3 Add jstudent to the Group</a></li>
<li><a href="#sec-7-4">7.4 Set Permissions and Ownership</a></li>
</ul>
</li>
<li><a href="#sec-8">8 SELinux</a></li>
<li><a href="#sec-9">9 Configuration</a>
<ul>
<li><a href="#sec-9-1">9.1 Start the Services</a></li>
<li><a href="#sec-9-2">9.2 Enable the Services on Boot</a></li>
<li><a href="#sec-9-3">9.3 Test the Configuration</a>
<ul>
<li><a href="#sec-9-3-1">9.3.1 Test the Configuration</a></li>
<li><a href="#sec-9-3-2">9.3.2 Test the Connection</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-10">10 Firewall Configuration</a></li>
<li><a href="#sec-11">11 Connect from Windows</a></li>
<li><a href="#sec-12">12 What to Submit</a></li>
<li><a href="#sec-13">13 Resources</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">


<p>
  Samba provides secure, stable and fast file and print services for Linux and Windows clients using the SMB/CIFS protocol.  In this assignment you will configuration Samba on CentOS 7 using command line tools.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Assignment Objectives</h2>
<div class="outline-text-2" id="text-2">


<p>
  When you have successfully completed this assignment you will be able to:
</p>
<ul>
<li>Configure a Samba server on CentOS 7.
</li>
<li>Create a Samba user.
</li>
<li>Configure SELinux to work with Samba.
</li>
<li>Configure a firewall to allow Samba connections.
</li>
<li>Connect to the Samba server from a Windows workstation.
</li>
</ul>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Terms You Should Know</h2>
<div class="outline-text-2" id="text-3">


<dl>
<dt>/etc/samba/smb.conf</dt><dd>The Samba configuration file.
</dd>
<dt>smb</dt><dd>Server Message Block daemon
</dd>
<dt>nmb</dt><dd>NetBIOS Message Block daemon
</dd>
<dt>smbclient</dt><dd>CLI tool to show Samba configuration.
</dd>
<dt>testparm</dt><dd>CLI tool to check /etc/samba/smb.conf syntax.
</dd>
<dt>system-config-samba</dt><dd>GUI configuration tool for Samba
</dd>
<dt>firewall-config</dt><dd>GUI firewall configuration tool
</dd>
</dl>


</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Preparation</h2>
<div class="outline-text-2" id="text-4">


<ul>
<li>Use a CentOS 7 virtual Machine on the 192.168.201.0/24 network or if in the lab 192.168.203.0/24.
</li>
<li>Set networking to <i>Bridged Adapter</i>, connect the cable and refresh the MAC address.
</li>
<li>Boot the VM and take a <a href="https://www.virtualbox.org/manual/ch01.html#snapshots">snapshot</a> in VirtualBox so you can roll back if you have problems.
</li>
<li>Change the IP addresses in this assignment to match your IP address. Use <code>ip addr show</code>.
</li>
</ul>


</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Install Samba</h2>
<div class="outline-text-2" id="text-5">


<p>
  If needed install <code>samba</code>, <code>samba-client</code> and <code>rcpbind</code>.
</p>
<pre class="example">
# yum install samba samba-client rpcbind
</pre>


</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Create Samba User</h2>
<div class="outline-text-2" id="text-6">


<p>   
   Create a new user that you will add as a Samba user.
</p>



<pre class="example"># useradd jstudent
</pre>


<p>
   Than add <i>jstudent</i> as a Samba user.
</p>
<pre class="example">
# smbpasswd -a jstudent
</pre>


</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Create a Samba Share</h2>
<div class="outline-text-2" id="text-7">


<ol>
<li>Add a directory to share.
</li>
</ol>


<pre class="example">
# mkdir -p /home/shared
</pre>



</div>

<div id="outline-container-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Add Content</h3>
<div class="outline-text-3" id="text-7-1">


<p>
   Create a text file in the shared directory.  Change <i>jstudent</i> to your name and the IP address to that of your Samba server.
</p><pre class="example">
# echo "This is Jstudent on 192.168.201.123" &gt; /home/shared/Success!
</pre>


</div>

</div>

<div id="outline-container-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Add a Group</h3>
<div class="outline-text-3" id="text-7-2">


<pre class="example">
# groupadd staff
</pre>


</div>

</div>

<div id="outline-container-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> Add jstudent to the Group</h3>
<div class="outline-text-3" id="text-7-3">


<pre class="example">
# usermod -aG staff jstudent
# smbpasswd -a tux
</pre>


</div>

</div>

<div id="outline-container-7-4" class="outline-3">
<h3 id="sec-7-4"><span class="section-number-3">7.4</span> Set Permissions and Ownership</h3>
<div class="outline-text-3" id="text-7-4">


<pre class="example">
# chgrp -R staff /home/shared
# chmod 0755 /home/shared
</pre>


</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> SELinux</h2>
<div class="outline-text-2" id="text-8">


<p>
  The directory you created needs the correct SELinux security context.  The last command will allow Samba users to access their home directories as well.  If the necessary SELinux tools are not installed use <code>yum whatprovides semanage</code> to find the correct package.
</p>



<pre class="example"># chcon -R -t samba_share_t /home/shared
# semanage fcontext -a -t samba_share_t /home/shared
# setsebool -P samba_enable_home_dirs on
</pre>


</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Configuration</h2>
<div class="outline-text-2" id="text-9">


<p>
  Backup <code>/etc/samba/smb.conf</code> and uncomment the [public] section by removing the semi-colons from the start of each line.  Change the shared directory to match the one you created.
</p>

</div>

<div id="outline-container-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Start the Services</h3>
<div class="outline-text-3" id="text-9-1">





<pre class="example"># systemctl start smb.service
# systemctl start nmb.service
</pre>


</div>

</div>

<div id="outline-container-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> Enable the Services on Boot</h3>
<div class="outline-text-3" id="text-9-2">





<pre class="example"># systemctl enable smb.service
# systemctl enable nmb.service
</pre>


</div>

</div>

<div id="outline-container-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> Test the Configuration</h3>
<div class="outline-text-3" id="text-9-3">


<p>
   Use <code>testparm</code> to test the syntax of the file.
</p>

</div>

<div id="outline-container-9-3-1" class="outline-4">
<h4 id="sec-9-3-1"><span class="section-number-4">9.3.1</span> Test the Configuration</h4>
<div class="outline-text-4" id="text-9-3-1">


<p>
     You can test the configuration from another Linux VM using <code>smbclient</code>.
</p>
<pre class="example">
$ smbclient -L \\192.168.201.123 -U jstudent
</pre>


</div>

</div>

<div id="outline-container-9-3-2" class="outline-4">
<h4 id="sec-9-3-2"><span class="section-number-4">9.3.2</span> Test the Connection</h4>
<div class="outline-text-4" id="text-9-3-2">


<p>
    Before configuring the firewall you can test the connection from a Windows workstation on the same subnet.  You will be asked to login as the Samba user you created.  If asked for a network password use the one you created for your user.
</p>
<pre class="example">
\\192.168.201.123
</pre>


</div>
</div>
</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Firewall Configuration</h2>
<div class="outline-text-2" id="text-10">


<p>
  Install <i>firewalld</i>.
</p>
<pre class="example">
# yum install firewalld
</pre>


<p>
  Start the firewall.
</p>
<pre class="example">
# systemctl start firewalld
</pre>


<p>
  Add <i>samba</i> as a service.
</p>



<pre class="example"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --list-services
</pre>



</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Connect from Windows</h2>
<div class="outline-text-2" id="text-11">


<p>
  From the Windows Run dialog box using the IP address of your Samba server.
</p>
<pre class="example">
\\192.168.201.123
</pre>


<p>
  You will be asked for the user name and password for <i>jstudent</i>.  The network password will be the same.
</p>
</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> What to Submit</h2>
<div class="outline-text-2" id="text-12">


<p>
  Submit a screenshot of the output of the <code>smbclient</code> command showing the Samba share or from Windows showing the connection.
</p>
</div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> Resources</h2>
<div class="outline-text-2" id="text-13">


<ul>
<li><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html">Red Hat Security Guide</a>
</li>
<li><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/">Red Hat Networking Guide</a>
</li>
</ul>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2016-09-15 Thu</p>
<p class="author">Author: Dennis Kibbe</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
