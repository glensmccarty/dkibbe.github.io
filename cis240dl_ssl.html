<h1 id="self-signed-ssl-cert">Self-Signed SSL Cert</h1>



<h2 id="overview">Overview</h2>

<p><img src="https://www.secure-travel.co.uk/images/ssl_padlock.jpg" alt="https://www.secure-travel.co.uk/images/ssl_padlock.jpg" title=""></p>

<p>SSL is the encryption technology used to protect your confidentiality on the web. It is similar to using SSH keys in that there is a public and private key involved. In addition the public key (in the certificate sent to Firefox) is signed by Certificate Authority (CA) that vouches for the authenticity of the web site. It is somewhat like using a Notary Public to verify your signature.</p>

<p>In this assignment you will create and install a self-signed certificate for the Apache web server.</p>



<h2 id="assignment-objectives">Assignment Objectives</h2>

<p><em>When you have successfully completed this assignment you will be able to:</em></p>

<ul>
<li>Create a SSL certificate.</li>
<li>Open a port in the firewall for <code>https</code>.</li>
<li>Connect to the Apache web server using SSL.</li>
</ul>

<h2 id="terms-you-should-know">Terms You Should Know</h2>

<ul>
<li><strong>Secure Socket Layer</strong> – The encryption technology that protects sites on the web.</li>
<li><strong>PKI:</strong> Public Key Infrastructure</li>
<li><strong>CA:</strong> Certificate Authority, a recognized agency that issues SSL certificates such as Verisign.</li>
<li><strong>.key:</strong> The extension for the private key</li>
<li><strong>.csr:</strong> The extension for the signing request sent to the registrar. (Not used here.)</li>
<li><strong>.crt:</strong> The extension for the self-signed key</li>
<li><strong>x509:</strong> X.509 is an ITU-T standard for a public key infrastructure (PKI).</li>
<li><strong>Port 443:</strong> Secure https</li>
</ul>

<h2 id="preparation">Preparation</h2>

<p>Use the same CentOS virtual machine with Apache installed. <em>Note:</em> Some of the commands in this assignment extend over more than one line. A <strong>** character at the end of line indicates that the command continues on the next line. Type the </strong>** character and then press Enter to continue the command on the next line or do not type <em>**</em> or press Enter and just continue typing the command.</p>

<h2 id="remove-default-cert-and-key">Remove Default Cert and Key</h2>

<p>Apache may not recognize your new certification and key files if the default ones are still in place.</p>

<ol>
<li>Remove the default <strong>localhost.crt</strong> file from <code>/etc/pki/tls/certs</code></li>
<li>Remove the default <strong>localhost.key</strong> file from <code>/etc/pki/tls/private</code></li>
</ol>

<h2 id="generate-the-private-key">Generate the Private Key</h2>

<p>This OpenSSL command will generate a 2048-bit private key. The actual key name can be anything you like just keep the <em>.key</em> extension. Create the key in root’s home directory. Later you’ll copy the key to <code>/etc/pki/tls/private/</code></p>

<h2 id="generate-the-certificate-signing-request">Generate the Certificate Signing Request</h2>

<p>A <em>Certificate Signing Request</em> is sent to the <em>Certificate Authority</em> when you purchase a SSL certificate. Create the CSR with this command and replace <em>Common Name</em> with your first and last name. <em>Note:</em> This <strong>must</strong> be in the screenshot you submit!</p>

<p>Fill out the appropriate fields in the CSR. If you used a different name to creste the private key ypu must use that name in the command to create the CSR.</p>

<h2 id="generate-self-signed-certificate-and-sign-the-private-key">Generate Self-Signed Certificate and Sign the Private Key</h2>

<p>In public-key infrastructure (PKI) systems, a Certificate Signing Request (CSR) is sent to a Certificate Authority in order to apply for a digital identity certificate. In this assignment you will generate a self-signed certificate using the information in the CSR you created. A signed private key will also be created.</p>

<h3 id="copy-the-new-certificate-to-the-pki-directory">Copy the New Certificate to the PKI Directory</h3>

<p>Copy the <code>ca.crt</code> to <code>/etc/pki/tls/certs</code>.</p>

<h3 id="change-permissions">Change Permissions</h3>

<h2 id="delete-the-csr">Delete the CSR</h2>

<p>Once the CSR has been used to create the certificate it is no longer needed.</p>

<h2 id="install-the-private-key">Install the Private Key</h2>

<p>Copy the private key to <code>/etc/pki/tls/private</code>.</p>

<h3 id="change-permissions-1">Change Permissions</h3>

<h2 id="enable-the-new-certificate">Enable the New Certificate</h2>

<p>The last step is to enable the new certificate in <code>/etc/httpd/conf.d/ssl.conf</code>. There are two directives that must be edited.</p>

<p>Comment out these lines and add a new entry below each with your key and certificate paths. Make sure the crt and key names match the ones you used.</p>

<h3 id="reload-the-apache-configuration">Reload the Apache configuration</h3>

<h2 id="open-port-443-in-the-firewall">Open Port 443 in the Firewall</h2>

<pre><code># firewall.cmd --add-service-https
</code></pre>

<h2 id="add-a-secure-virtual-host-name-based-virtual-hosts">Add a Secure Virtual Host (Name-Based Virtual Hosts)</h2>

<p>There is already a secure VirtualHost stanza in <code>ssl.conf</code> so <a href="https://example.com">https://example.com</a> will work without any additional editing.</p>

<p>You can add a secure virtual host for any other website you have created to <code>/etc/httpd/conf.d/vhosts.conf</code>. Each site can have its own certificate and private key. See <a href="#sec-16">Resources</a> below for a link to the template on my web site. Make sure that directories exist and the port 443 is open in the firewall. Also, use the IP address of your virtual host. The entry will look something like this:</p>

<h3 id="default-443-virtualhost-stanza">Default 443 VirtualHost Stanza</h3>

<p>The <code>ssl.conf</code> file contains a default VirtualHost stanza. You should either place your changes in that file or comment it out.</p>

<h2 id="troubleshoot-the-assignment">Troubleshoot the Assignment</h2>

<ul>
<li>Make sure your name appears in the certificate screenshot.</li>
<li>Did you copy the files to the correct directories?</li>
<li>Make sure to remove the old <code>Localhost.crt</code> and <code>localhost.key</code> files.</li>
<li>Make sure to edit the <code>/etc/httpd/conf.d/ssl.conf</code> file with the correct file names.</li>
<li>Is port 443 open in the firewall?</li>
<li>If you get an error when restarting Apache about overlapping VirtualHosts on port 443 do not create a stanza in <code>vhosts.conf</code> with <strong></strong></li></ul>

<h2 id="what-to-submit">What to Submit</h2>

<p>Submit a screenshot of the certificate details from the warming dialog in Firefox. Make sure that your first and last name show in the <strong>Common Name</strong> field.</p>

<p><img src="http://classfiles.dennisk.fastmail.net/ssl_cert.png" alt="http://classfiles.dennisk.fastmail.net/ssl_cert.png" title=""></p>

<h2 id="resources">Resources</h2>

<ul>
<li><a href="http://wiki.centos.org/HowTos/Https">Setting UP a SSL Secured Web server with CentOS</a></li>
<li>https Everywhere</li>
</ul>

<blockquote>
  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>