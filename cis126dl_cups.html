<h1 id="cups">CUPS</h1>



<h2 id="introduction">Introduction</h2>

<p>CUPS is the standard printing system for Unix and Linux. CUPS offers several ways to configure printers. We’ll use the web interface and the command line to configure a printer and print a manpage using Ghostscript.</p>

<h2 id="learning-objectives">Learning Objectives</h2>

<p><em>When you have successfully completed this assignment you will be able to:</em></p>

<ol>
<li>Install the CUPS printer server.</li>
<li>Configure CUPS for remote administration.</li>
<li>Add a printer using the CUPS web interface.</li>
<li>Add a printer from the command line.</li>
</ol>

<h2 id="terms-you-should-know">Terms You Should Know</h2>

<ul>
<li><strong>CUPS:</strong> Printing service for Linux and Apple.</li>
<li><strong>/etc/cups/cupsd.conf:</strong> Main CUPS configuration file.</li>
<li><strong>IPP:</strong> Internet Printing Protocol</li>
<li><strong>lp:</strong> Line Printer</li>
<li><strong>lpq:</strong> Line Printer Queue</li>
<li><strong>lprm:</strong> Remove a print job.</li>
<li><strong>lpstat:</strong> Check the status of printers. Use <strong>-a</strong> to list all.</li>
<li><strong>lpadmin:</strong> Configure CUPS from the command line.</li>
<li><strong>lpinfo:</strong> Lists the drivers CUPS supports.</li>
<li><strong>ppd:</strong> PostScript Printer Description</li>
<li><strong>PostScript:</strong> Page description language</li>
<li><strong>Ghostscript:</strong> A free implementation of PostScript</li>
</ul>

<h2 id="preparation">Preparation</h2>

<p>For this assignment you’ll use the web interface to CUPS to install a printer on Fedora and then use the command line to install the classroom printer on CentOS 6.5. Set both virtual machines to <em>Bridged</em> and refresh the MAC address before starting the virtual machines. Both virtual machines must be on the 192.168.201.0/24 network to reach the printer.</p>

<h2 id="internet-printing-protocol">Internet Printing Protocol</h2>

<p>The HO LaserJet 420 in the classroom supports direct printing over the network. You can access the printer from a web browser at this address.</p>

<pre><code>http://192.168.201.221
</code></pre>

<h2 id="install-the-cups-print-server">Install the CUPS Print Server</h2>

<p>Use <strong>grouplist</strong> option for <code>yum</code> to find the correct software groups to install.</p>

<pre><code>root@vm1# yum grouplist *print*
Print Client
Print Server
</code></pre>

<p>Install both the <em>Print Client</em> and the <em>Print Server.</em> Be sure to quote the group names.</p>

<pre><code># yum groupinstall "Print Client" "Print Server"
</code></pre>

<h2 id="open-internet-printing-protocol-ports">Open Internet Printing Protocol Ports</h2>

<p>Use <code>system-config-firewall-tui</code> to open the trusted service. If needed use <code>yum</code> to install the package.</p>

<p><img src="https://s3.amazonaws.com/CIS126DL/Images/firewall_ipp.png" alt="Firewall" title="Firewall"></p>

<!--## Configure CUPS for Remote Administration&#10;&#10;Backup */etc/cups/cupsd.conf*.&#10;&#10;By default CUPS only listens on localhost. Place the comment character in front of the *Listen* directive and add a line to listen on a port instead.&#10;&#10;    # Listen localhost:631&#10;    Port 631&#10;&#10;To change access to server, admin pages, configuration files add this line to the appropriate sections.&#10;&#10;    Allow from all&#10;&#10;Reload `cups` and you should now be able to access the CUPS web interface remotely from the workstation.&#10;&#10;    root@vm1# service cups reload&#10;-->

<h2 id="adding-a-printer-through-firefox">Adding a Printer Through Firefox</h2>

<p>CUPS listens on port 631 for connections from localhost. This makes it possible to administer CUPS from a web browser.</p>

<h3 id="is-the-service-running">Is the Service Running?</h3>

<p>Open a terminal and as root check the status of the CUPS service.</p>

<pre><code># systemctl status cups.service
</code></pre>

<p>If CUPS is <em>inactive</em> start the service.</p>

<pre><code># systemctl start cups.service
</code></pre>

<h2 id="open-the-cups-administration-page">Open the CUPS Administration Page</h2>

<p>Connect to CUPS on Port 631 from Firefox. Enter this URL in the address bar.</p>

<pre><code>localhost:631
</code></pre>

<p>Click the Administration link and enter root’s authentication.</p>

<h2 id="add-a-printer-from-the-web-interface">Add a Printer from the Web Interface</h2>

<ol>
<li>Select <em>Add a Printer</em>.</li>
<li>You should see the HP LaserJet 4250. (If not, See next section.)</li>
<li>Click <em>Continue</em> and enter a location for the printer, BA1E.</li>
<li>Click Continue.</li>
<li>From the Model list select HP LaserJet 4250 Foomatic/Postscript.</li>
<li>Click <em>Add Printer</em></li>
<li>Click <em>Query Printer for Default Options.</em></li>
<li>In the Administration drop-down menu on the next screen select <em>Set as Server Default.</em></li>
<li>From the Maintenance drop-down menu select *Print Test Page.” </li>
</ol>



<h3 id="if-network-printer-isnt-detected">If Network Printer Isn’t Detected</h3>

<p>If the network printer isn’t automatically detected select IPP Printing from the list and enter <strong>socket://192.168.201.221:9100</strong> as the printer URL.Then follow the instructions above.</p>

<h2 id="configure-cups-from-the-command-line-centos-minimal">Configure CUPS From the Command Line (CentOS Minimal)</h2>

<p>The <code>lpadmin</code> command is used to configure CUPS from the command line. You’ll need to run <code>lpinfo</code> to find the proper <strong>ppd</strong> file for your make and model printer.</p>

<h3 id="find-the-correct-ppd-file">Find the Correct ppd File</h3>

<pre><code>root@vm1# lpinfo -m | grep 'LaserJet 4250'
lsb/usr/HP/hp-laserjet_4250-ps.ppd.gz
</code></pre>

<p>Then use <code>lpadmin</code> to add the printer. At the end of each line type the backslash characrer and then <strong>Return</strong> to Bash to accept that line and start a new line. The Bash shell will place a new prompt <strong>&gt;</strong> for you to continue. <em>Note:</em> Double check your quotes before pressing <strong>Return.</strong></p>

<pre><code>root@vm1# lpadmin -p "hp_laser" -E \  
-v socket://192.168.201.221 \  
-m "lsb/usr/HP/hp-laserjet_4250-ps.ppd.gz" \  
-D "This line is for information only." \  
-L "Location"
</code></pre>

<p>After pressing <strong>Return</strong> after the last line it will take a minute until the prompt is returned.</p>

<p>Check that the printer is ready.</p>

<pre><code>root@vm1# lpstat -a
hp_laser accepting requests since. . .
</code></pre>

<p>Set the printer as the default so you don’t need to type the printer name each time you want to print.</p>

<pre><code>lpadmin -d "hp_laser"
</code></pre>

<p>The output should say that the printer is accepting requests.</p>

<p>The <code>lpq</code> command confirms the printer is ready and set as default.</p>

<pre><code>root@vm1# lpq
hp_laser is ready
no entries
</code></pre>

<h2 id="print-from-the-command-line">Print from the Command Line</h2>



<h3 id="print-a-man-page">Print a Man Page</h3>

<p>This command will send a PostScript file to the default printer.</p>

<pre><code>man -t pwd | lp
</code></pre>

<h2 id="postscript">PostScript</h2>

<p>PostScript is a page description programming language. It creates a plain text file that describes how to put the characters on the page based on the properties of the ppd file used. You can test this by creating a Postscript file (on the workstation not the virtual machine) and opening the text file with <code>less</code>.</p>

<pre><code>root@vm1# man -t pwd &gt; pwd.ps
root@vm1# less pwd.ps
</code></pre>

<!--## Convert PostScript to PDF.&#10;&#10;Portable Document Format or PDF is derived from PostScript. You can convert a PostScript file to a PDF with `ps2pdf`.&#10;&#10;    $ ps2pdf pwd.ps&#10;    $ epdfview pwd.pdf&#10;-->

<h2 id="debug-the-assignment">Debug the Assignment</h2>

<ol>
<li>Plenty of chances for typos in this assignment.</li>
<li>If after running <code>lpstat -a</code> you get an error that the printer is not accepting requests you probably did not enable the printer by omitting <code>-E</code>.</li>
<li>The classroom printer connects through a Windows box in the lab. Expect the web page to be S-L-O-W.</li>
</ol>

<!--## XKCD&#10;&#10;![XKCD cartoon][xkcd]&#10;-->



<h2 id="what-to-submit">What to Submit</h2>

<p>Turn in the manpage <em>you</em> printed with your name on it.</p>

<h2 id="resources">Resources</h2>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/CUPS#Remote_access_to_web_interface" title="Remote Access to CUPS Web Interface">Remote Access to CUPS Web Interface</a></li>
<li><a href="http://adobe.com/print/features/psvspdf/" title="Postscript vs. PDF">Postscript vs. PDF</a></li>
<li><a href="http://www.ghostscript.com" title="Ghostscript">Ghostscript</a></li>
</ul>

<!-- Links&#10;&#10;This is [an example](http://example.com/ &#34;Title&#34;) inline link.&#10;This is [an example][id] reference-style link.&#10;![alt text](/path/img.jpg &#34;Title&#34;)&#10;![alt text][id]&#10;-->

<blockquote>
  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>